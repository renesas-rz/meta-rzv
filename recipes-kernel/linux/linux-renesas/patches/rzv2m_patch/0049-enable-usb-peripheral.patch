From 520624f3f88850bef76cb4ded895abbcf61eaf1d Mon Sep 17 00:00:00 2001
From: Canh Dao <canh.dao.ct@renesas.com>
Date: Wed, 15 Sep 2021 10:20:33 +0700
Subject: [PATCH] enable-usb-peripheral

Signed-off-by: Canh Dao <canh.dao.ct@renesas.com>
---
 arch/arm64/boot/dts/renesas/r9a09g011gbg.dtsi | 5 +++--
 drivers/usb/gadget/udc/renesas_usb3.c         | 8 ++++----
 2 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/arch/arm64/boot/dts/renesas/r9a09g011gbg.dtsi b/arch/arm64/boot/dts/renesas/r9a09g011gbg.dtsi
index e63e76f..ba3ca03 100644
--- a/arch/arm64/boot/dts/renesas/r9a09g011gbg.dtsi
+++ b/arch/arm64/boot/dts/renesas/r9a09g011gbg.dtsi
@@ -205,10 +205,11 @@
             compatible = "renesas,r8a774c0-usb3-peri",
                      "renesas,rcar-gen3-usb3-peri";
             reg = <0 0x85070000 0 0x1000>;
-            interrupts = <GIC_SPI 242 IRQ_TYPE_LEVEL_HIGH>,
+/*            interrupts = <GIC_SPI 242 IRQ_TYPE_LEVEL_HIGH>,
                      <GIC_SPI 243 IRQ_TYPE_LEVEL_HIGH>,
                      <GIC_SPI 244 IRQ_TYPE_LEVEL_HIGH>,
-                     <GIC_SPI 246 IRQ_TYPE_LEVEL_HIGH>;
+                     <GIC_SPI 246 IRQ_TYPE_LEVEL_HIGH>;*/
+            interrupts = <GIC_SPI 246 IRQ_TYPE_LEVEL_HIGH>;
             clocks =  <&cpg CPG_MOD 405>;
             status = "disabled";
         };
diff --git a/drivers/usb/gadget/udc/renesas_usb3.c b/drivers/usb/gadget/udc/renesas_usb3.c
index b414d36..724a458 100644
--- a/drivers/usb/gadget/udc/renesas_usb3.c
+++ b/drivers/usb/gadget/udc/renesas_usb3.c
@@ -45,9 +45,9 @@
 #define USB3_USB_INT_ENA_2	0x22c
 #define USB3_STUP_DAT_0		0x230
 #define USB3_STUP_DAT_1		0x234
-#define USB3_USB_OTG_STA	0x268
-#define USB3_USB_OTG_INT_STA	0x26c
-#define USB3_USB_OTG_INT_ENA	0x270
+#define USB3_USB_OTG_STA        0x410
+#define USB3_USB_OTG_INT_STA    0x414
+#define USB3_USB_OTG_INT_ENA    0x418
 #define USB3_P0_MOD		0x280
 #define USB3_P0_CON		0x288
 #define USB3_P0_STA		0x28c
@@ -155,7 +155,7 @@
 #define USB_INT_2_PIPE(n)	BIT(n)
 
 /* USB_OTG_STA, USB_OTG_INT_STA and USB_OTG_INT_ENA */
-#define USB_OTG_IDMON		BIT(4)
+#define USB_OTG_IDMON           BIT(0)
 
 /* P0_MOD */
 #define P0_MOD_DIR		BIT(6)
-- 
2.7.4

